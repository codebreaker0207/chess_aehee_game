<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aehee 로그인</title>
  </head>
  <body> 
    <h2>구글 계정으로 로그인</h2>
    <p>이메일과 비밀번호 입력 없이 구글 계정으로만 로그인할 수 있습니다.</p>
    <button id="googleLoginBtn">구글로 로그인</button>
    <script type="module">
      import { 
        signInWithPopup, 
        signInWithRedirect, 
        getRedirectResult, 
        GoogleAuthProvider, 
        onAuthStateChanged 
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"; 
      import { auth } from "./firebase-config.js"; 
      const provider = new GoogleAuthProvider(); 
      provider.setCustomParameters({
        prompt: "select_account"
      });
      const googleLoginBtn = document.getElementById("googleLoginBtn");
      const googleLoginBtnDefaultLabel = googleLoginBtn.textContent;
      const redirectToHome = () => {
        window.location.href = "index.html"; 
      };
      // 이미 로그인된 사용자는 홈으로 이동
      onAuthStateChanged(auth, (user) => {
        if (user) {
          redirectToHome();
        } 
      });
      googleLoginBtn.addEventListener("click", async () => {
        try {
          googleLoginBtn.disabled = true;
          googleLoginBtn.textContent = "구글 로그인 중...";
          await signInWithPopup(auth, provider); alert("구글 로그인 성공!");
          redirectToHome();
        } catch (e) {
          if (e.code === "auth/popup-blocked" || e.code === "auth/operation-not-supported-in-this-environment") {
            try {
              await signInWithRedirect(auth, provider);
              return;
            } catch (redirectError) {
              alert("구글 로그인 실패: " + redirectError.message); 
            }
          } else { alert("구글 로그인 실패: " + e.message);
                 }
        } finally { googleLoginBtn.disabled = false; googleLoginBtn.textContent = googleLoginBtnDefaultLabel; 
                  } 
      });
      getRedirectResult(auth)
        .then((result) => {
          if (result) {
            alert("구글 로그인 성공!"); 
            redirectToHome(); 
          } 
        })
        .catch((error) => {
          if (error) {
            alert("구글 로그인 실패: " + error.message); 
          } 
        }); 
    </script> 
  </body> 
</html>
